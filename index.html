<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> luobbe的随笔</title><meta name="description" content="luobbe | iOS | swift"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.luobbe.com/atom.xml" title="luobbe的随笔"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link active">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><ul class="home post-list"><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2016/01/15/图片添加标签-LBTagView/" class="post-title-link">图片添加标签:LBTagView</a></h2><div class="post-info">2016年1月15日</div><div class="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><hr>
<p>前两天写了一个轮子，主要是给图片视图添加标签的，昨天在微博上艾特<a href="http://weibo.com/onevcat" target="_blank" rel="noopener">喵大</a>、<a href="http://weibo.com/u/1438670852" target="_blank" rel="noopener">叶神</a>和<a href="http://weibo.com/luohanchenyilong" target="_blank" rel="noopener">iOS程序犭袁</a>，然后火了一把，首先我感谢各位对这个小小功能的关注，让我受宠若惊。效果主要是这个样子</p>
<p><img src="http://ww3.sinaimg.cn/bmiddle/9f1201f5jw1ezz5g7arztg209g0de4g6.gif" alt="gif"></p>
<p>这两天也有小伙伴私信我能不能简单的讲一下其中的原理，其实用到的知识很简单，今天我就简单地说一下原理和实现。</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><hr>
<p>为了方便，我们姑且称这个控件是<code>LBTagView</code>，他的组成主要是一个带有三角形<code>Label</code>、一个小圆点的<code>UIView</code>和<code>CALayer</code>逐渐放大的圆环。三角形的<code>Label</code>是用<code>CAShapeLayer</code>结合<code>UIBezierPath</code>画出来的，大致的原理就是这样的，下面我们来把主要的步骤实现一下。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><hr>
<ul>
<li>三角形的<code>Label</code></li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)triangle:(<span class="built_in">UILabel</span> *)label</span><br><span class="line">&#123;</span><br><span class="line">    [label.layer.sublayers makeObjectsPerformSelector:<span class="keyword">@selector</span>(removeFromSuperlayer)];</span><br><span class="line">    <span class="built_in">CGFloat</span> angleWidth = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">UIBezierPath</span>  * path =  [ <span class="built_in">UIBezierPath</span>  new ];</span><br><span class="line">    [path moveToPoint :( <span class="built_in">CGPoint</span> ) &#123; angleWidth ,  <span class="number">0</span> &#125;];</span><br><span class="line">    [path addLineToPoint :( <span class="built_in">CGPoint</span> ) &#123; <span class="number">0</span>, <span class="built_in">CGRectGetHeight</span>(label.frame)/<span class="number">2.0</span>&#125;];</span><br><span class="line">    [path addLineToPoint :( <span class="built_in">CGPoint</span> ) &#123; angleWidth, <span class="built_in">CGRectGetHeight</span>(label.frame)&#125;];</span><br><span class="line">    [path addLineToPoint :( <span class="built_in">CGPoint</span> ) &#123; <span class="built_in">CGRectGetWidth</span>(label.frame), <span class="built_in">CGRectGetHeight</span>(label.frame)&#125;];</span><br><span class="line">    [path addLineToPoint :( <span class="built_in">CGPoint</span> ) &#123; <span class="built_in">CGRectGetWidth</span>(label.frame), <span class="number">0</span>&#125;];</span><br><span class="line">    [path addLineToPoint :( <span class="built_in">CGPoint</span> ) &#123; angleWidth, <span class="number">0</span>&#125;];</span><br><span class="line">    <span class="built_in">CAShapeLayer</span>* mask = [<span class="built_in">CAShapeLayer</span> layer];</span><br><span class="line">    mask.path = path.CGPath ;</span><br><span class="line">    label.layer.mask = mask;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这些代码所要达到的效果大概如下，其实显示的主要是<code>CAShapeLayer</code>所在红框部分的内容</div><a href="/2016/01/15/图片添加标签-LBTagView/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2015/12/29/写在2015年末/" class="post-title-link">写在2015年末</a></h2><div class="post-info">2015年12月29日</div><div class="post-content"><p>今天看了喵神的年终总结，感触挺多的。回头看看自己的一年，今天我一直在回忆15年自己做了些什么，索性也来做个记录吧！</p>
<p>15年对我来说，注定是不平凡的一年！</p>
<h2 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h2><p>在14年末开始准备App2.0版本的开发工作，到15年初2.0版本的上线，新版本的整个界面风格完全发生了变化，代码从零开始，经过了两个半月的时间，保质保量的完成了新版本的发布！在15年里，App小版本迭代了十多次，基本上是每月一更，另外又开发了两个全新的App，每次开发都去不断尝试新的东西，研究新的技术，让我学到了很多。无论是个人技术的提升，还是团队的管理。</p>
<h2 id="个人技能"><a href="#个人技能" class="headerlink" title="个人技能"></a>个人技能</h2><p>今年参与开发了三个项目，两个是由我主开发，从项目框架的搭建到代码质量的把控，自己的技能都提升了不少。搭建项目的时候，一定要考虑整个App的布局，一个好的框架能提升不少开发时间的，然后就是基类的封装，在封装一些基类的时候，一定要考虑到共性和特性；网络层的设计，数据存储的设计等。还有一点我感觉最重要的就是代码规范，代码规范，代码规范！！！重要的事情说三遍。好的代码能使我看着舒服，能写注释的尽量写注释，方便以后维护。</div><a href="/2015/12/29/写在2015年末/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2015/12/13/shadowsocks-sspanel/" class="post-title-link">搭建自己的shadowsocks分享服务器</a></h2><div class="post-info">2015年12月13日</div><div class="post-content"><blockquote>
<p>本文针对 ss-panel V2 版本的教程</p>
</blockquote>
<p>周末本想出去转转，无奈帝都的雾霾太大，只能在家里撸码，整了一个ss账号分享平台，在这记录一下过程吧。</p>
<p>本文是基于Ubuntu 14.04下使用后端manyuser和前端ss-panel，使用nginx做代理所搭建的。<br>服务器推荐<a href="https://www.vultr.com/?ref=6928081" target="_blank" rel="noopener">vultr</a>、<a href="https://m.do.co/c/fe08bbc0a6c0" target="_blank" rel="noopener">digitalocean</a>。</p>
<h6 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h6><p>首先我们远程登录服务器，安装nginx,mysql和php,具体命令如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-512mb-sfo1-01:~# apt-get update</span><br><span class="line">root@ubuntu-512mb-sfo1-01:~# apt-get install nginx</span><br><span class="line">root@ubuntu-512mb-sfo1-01:~# apt-get install mysql-client-5.5 mysql-server-5.5</span><br><span class="line">root@ubuntu-512mb-sfo1-01:~# apt-get install php5 php5-fpm php5-cli php5-cgi php5-mysql php5-gd</span><br></pre></td></tr></table></figure></p>
<p>过程中如果没有错误，那就说明我们安装成功了，如果服务器中有这些环境，则可以忽略对应的步骤。</p>
<p>接下来我们就要创建数据库了，运行<code>mysql -u root -p</code>，输入<code>root</code>密码。开始创建<code>shadowsocks</code>数据库，具体<code>SQL:create database shadowsocks;</code>,如下图：</p>
<p><img src="http://ww4.sinaimg.cn/large/9f1201f5gw1eyydknilqkj20vq0c2wkj.jpg" alt=""></p>
<p>然后建立一个名为ss，密码为ss的MySQL用户，因为这个用户只能本地登录，所以密码简单点也无所谓：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  grant all privileges on shadowsocks.* to ss@localhost identified by &apos;ss&apos;;</span><br></pre></td></tr></table></figure></p>
<p>创建完成我们退出MySQL:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  exit；</span><br></pre></td></tr></table></figure></p>
<p>到这步，我们的数据库已经完成了。</div><a href="/2015/12/13/shadowsocks-sspanel/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2015/11/25/casharplayer-percent/" class="post-title-link">使用CAShapeLayer实现环形进度条</a></h2><div class="post-info">2015年11月25日</div><div class="post-content"><p>最近做项目的时候，射击狮设计了一个环形的进度条用来向用户呈现产品的信息，做完之后，感觉这个效果应该挺常用的，索性就整理一下了。</p>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>分析了一下效果图，其实里面主要就三个主要元素，一个白色的半透明的背景圆环，姑且称之为A吧，一个橘黄色的进度圆环，称之为B，一个现实百分比的<code>label</code>。圆环可以结合<code>CAShapeLayer</code>和<code>UIBezierPath</code>进行绘制，那么整过过程就很简单了。关于<code>CAShapeLayer</code>官方的API可以查看<a href="https://developer.apple.com/library/mac/documentation/GraphicsImaging/Reference/CAShapeLayer_class/" target="_blank" rel="noopener">这里</a>。</p>
<h3 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h3><p>为了方便我把画笔的宽度，开始和结束的位置，背景颜色定义了宏，如下图</p>
<p><img src="http://ww1.sinaimg.cn/large/9f1201f5jw1eydlfv0zbnj21ae09swih.jpg" alt="image"></p>
<p>首先我们需要创建半透明白色背景的圆环A，代码如下：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建背景</span></span><br><span class="line">- (<span class="keyword">void</span>)initBackgroundView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPath];</span><br><span class="line">    [path addArcWithCenter:center radius:radius startAngle:ChartStart endAngle:ChartEnd clockwise:<span class="literal">YES</span>];</span><br><span class="line">    bgCircleLayer = [<span class="built_in">CAShapeLayer</span> layer];</span><br><span class="line">    bgCircleLayer.path = path.CGPath;</span><br><span class="line">    bgCircleLayer.fillColor = [<span class="built_in">UIColor</span> clearColor].CGColor;</span><br><span class="line">    bgCircleLayer.strokeColor = BackGroundColor.CGColor;</span><br><span class="line">    bgCircleLayer.lineWidth = ChartWidth;</span><br><span class="line">    [<span class="keyword">self</span>.layer addSublayer:bgCircleLayer];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了每次方便地设置环形进度，我们在<code>.h</code>文件中提供了一个方法：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setProgress:(<span class="keyword">double</span>)value animated:(<span class="built_in">BOOL</span>)animate;</span><br></pre></td></tr></table></figure>
<p>具体的实现如下：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setProgress:(<span class="keyword">double</span>)value animated:(<span class="built_in">BOOL</span>)animate</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSAssert</span>(value &lt; <span class="number">1</span> &amp;&amp; value &gt; <span class="number">0</span>, <span class="string">@"value是包含0、1之间的数值"</span>);</span><br><span class="line">    progress = value;</span><br><span class="line">    animated = animate;</span><br><span class="line">    radian = value * (<span class="number">2</span>* M_PI - fabs(ChartStart - ChartEnd));</span><br><span class="line">    <span class="keyword">self</span>.percentLB.text = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%.0f%%"</span>,progress*<span class="number">100</span>];</span><br><span class="line">    <span class="keyword">self</span>.percentLB.center = [<span class="keyword">self</span> percentCenter];</span><br><span class="line">    <span class="comment">//创建环形进度</span></span><br><span class="line">    [<span class="keyword">self</span> creatCircleLayer];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建环形进度的方法<code>- (void)creatCircleLayer</code>其实和环形的背景一样的，这里就不再贴代码了。</p>
<p>然后就是解决环形进度动画的问题了</div><a href="/2015/11/25/casharplayer-percent/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2015/10/14/3d-touch/" class="post-title-link">iOS 9 —3D Touch体验</a></h2><div class="post-info">2015年10月14日</div><div class="post-content"><p>3D Touch是iOS 9的新特性，趁着6s到手了，赶紧体验了一把，确实方便了不少，今天我就简单的介绍一下。</p>
<p>简单的说3D Touch就是通过区分轻按和重按来进行不同的用户交互。Xcode 7才支持3D Touch的开发，但是这个手势并不支持模拟器，还好在<code>github</code>上找到了一个<a href="https://github.com/DeskConnect/SBShortcutMenuSimulator" target="_blank" rel="noopener">插件</a>，可以在模拟器上模拟3D Touch的功能。插件的使用在<code>github</code>有上明确的教程，这里就不叙述了。</p>
<p>在苹果的开发者官网上我们可以3D Touch的链接：<a href="https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/Adopting3DTouchOniPhone/" target="_blank" rel="noopener">https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/Adopting3DTouchOniPhone/</a></p>
<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>3D Touch的主要应用分为三个模块：</p>
<p>1、 Home Screen Quick Actions</p>
<p>通过主屏幕的应用icon，我们可以用3D Touch呼出一个菜单，进行快速定位应用功能模块相关功能的开发。比如下图中的邮件：</p>
<p><img src="http://ww1.sinaimg.cn/large/9f1201f5gw1exhz4br12mj206j0693ys.jpg" alt=""></p>
<p>2.Peek and Pop</p>
<p>这个功能是一套全新的用户交互机制，在使用3D Touch时，我们可以预览下一个页面的视图，并且可以进行简单的操作。如下图：</p>
<p><img src="http://ww1.sinaimg.cn/large/9f1201f5gw1exhz61duq6j20af0ijaam.jpg" alt=""></p>
<p>3.Force Properties</p>
<p>iOS9为我们提供了一个新的交互参数:力度。我们可以检测某一交互的力度值，来做相应的交互处理。例如，我们可以通过力度来控制快进的快慢，音量增加的快慢等。</div><a href="/2015/10/14/3d-touch/" class="read-more">...more</a></article></li></ul></main><footer><div class="paginator"><a href="/page/2/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://blog.luobbe.com">luobbe</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>