<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> iOS 9 —3D Touch体验 · luobbe的随笔</title><meta name="description" content="iOS 9 —3D Touch体验 - luobbe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.luobbe.com/atom.xml" title="luobbe的随笔"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://weibo.com/luobbe" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/lovels" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">iOS 9 —3D Touch体验</h1><div class="post-info">2015年10月14日</div><div class="post-content"><p>3D Touch是iOS 9的新特性，趁着6s到手了，赶紧体验了一把，确实方便了不少，今天我就简单的介绍一下。</p>
<p>简单的说3D Touch就是通过区分轻按和重按来进行不同的用户交互。Xcode 7才支持3D Touch的开发，但是这个手势并不支持模拟器，还好在<code>github</code>上找到了一个<a href="https://github.com/DeskConnect/SBShortcutMenuSimulator" target="_blank" rel="noopener">插件</a>，可以在模拟器上模拟3D Touch的功能。插件的使用在<code>github</code>有上明确的教程，这里就不叙述了。</p>
<p>在苹果的开发者官网上我们可以3D Touch的链接：<a href="https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/Adopting3DTouchOniPhone/" target="_blank" rel="noopener">https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/Adopting3DTouchOniPhone/</a></p>
<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>3D Touch的主要应用分为三个模块：</p>
<p>1、 Home Screen Quick Actions</p>
<p>通过主屏幕的应用icon，我们可以用3D Touch呼出一个菜单，进行快速定位应用功能模块相关功能的开发。比如下图中的邮件：</p>
<p><img src="http://ww1.sinaimg.cn/large/9f1201f5gw1exhz4br12mj206j0693ys.jpg" alt=""></p>
<p>2.Peek and Pop</p>
<p>这个功能是一套全新的用户交互机制，在使用3D Touch时，我们可以预览下一个页面的视图，并且可以进行简单的操作。如下图：</p>
<p><img src="http://ww1.sinaimg.cn/large/9f1201f5gw1exhz61duq6j20af0ijaam.jpg" alt=""></p>
<p>3.Force Properties</p>
<p>iOS9为我们提供了一个新的交互参数:力度。我们可以检测某一交互的力度值，来做相应的交互处理。例如，我们可以通过力度来控制快进的快慢，音量增加的快慢等。<a id="more"></a></p>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>1.Home Screen Quick Actions分为静态和动态。静态的只需要在我们项目中的plist文件中配置，然后用户安装就可以使用了，具体的配置信息如下图：</p>
<p><img src="http://ww1.sinaimg.cn/large/9f1201f5gw1exhz6i485wj20fr02mt9k.jpg" alt=""></p>
<p>对应的plist文件的源码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span><br><span class="line">&lt;plist version=&quot;1.0&quot;&gt;</span><br><span class="line">&lt;array&gt;</span><br><span class="line">	&lt;dict&gt;</span><br><span class="line">		&lt;key&gt;UIApplicationShortcutItemType&lt;/key&gt;</span><br><span class="line">		&lt;string&gt;camera&lt;/string&gt;</span><br><span class="line">		&lt;key&gt;UIApplicationShortcutItemIconType&lt;/key&gt;</span><br><span class="line">		&lt;string&gt;UIApplicationShortcutIconTypeCompose&lt;/string&gt;</span><br><span class="line">		&lt;key&gt;UIApplicationShortcutItemTitle&lt;/key&gt;</span><br><span class="line">		&lt;string&gt;拍照&lt;/string&gt;</span><br><span class="line">	&lt;/dict&gt;</span><br><span class="line">&lt;/array&gt;</span><br><span class="line">&lt;/plist&gt;</span><br></pre></td></tr></table></figure>
<p>运行结果如下图：</p>
<p><img src="http://ww3.sinaimg.cn/large/9f1201f5gw1exhz7i4ha9j20e6089wf8.jpg" alt=""></p>
<p>另外一种就是动态的，动态需要我们使用代码来创建，具体使用到的类是<code>UIApplicationShortcutItem</code>,我们可以进入<code>UIApplicationShortcutItem.h</code>文件中包含的东西:</p>
<p>主要包含了三个类：</p>
<ul>
<li><code>UIApplicationShortcutIcon</code>：创建ShortcutItem中图片icon的类</li>
<li><code>UIApplicationShortcutItem</code>：创建3D Touch的ShortcutItem的类</li>
<li><code>UIMutableApplicationShortcutItem</code>：创建可变3D Touch的ShortcutItem的类</li>
</ul>
<p>因为这是ios 9新出来的API，所以并不是很复杂，我们来直接使用：</p>
<pre><code>UIApplicationShortcutItem *shareItem = [[UIApplicationShortcutItem alloc] initWithType:@&quot;Share&quot; localizedTitle:@&quot;分享&quot; localizedSubtitle:nil icon:[UIApplicationShortcutIcon iconWithType:UIApplicationShortcutIconTypeShare] userInfo:nil];
</code></pre><p>上述代码我们就用代码创建了一个3D Touch的条目，然后赋值给<code>application.shortcutItems</code>即可,运行如下图：</p>
<p><img src="http://ww3.sinaimg.cn/large/9f1201f5gw1exhz82efg1j206q045aa4.jpg" alt=""></p>
<p>值得提出的是Home Screen Quick Actions最多只能创建四个，多了就不会在显示了。点击每个<code>ShortcutItem</code>的处理在<code>UIApplication</code>中的，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)application:(UIApplication *)application performActionForShortcutItem:(UIApplicationShortcutItem *)shortcutItem completionHandler:(void(^)(BOOL succeeded))completionHandler</span><br></pre></td></tr></table></figure>
<p>然后我们可以针对不用的点击事件做不同的处理。</p>
<p>2.Peek and Pop</p>
<p>首先我们来看一下效果：</p>
<p><img src="http://ww4.sinaimg.cn/large/9f1201f5gw1exhz8potr7g209p0h27wh.gif" alt=""></p>
<p>这就是 3D Touch另外一个使用的案例。下面我们来说一下具体的实现。</p>
<p>要想在APP中使用3D Touch,首先我们需要判断该设备是否开启3d touch功能，因为用户可以在’设置-通用-辅助功能-3D Touch’中来开启关闭3D Touch功能。幸好这个功能是苹果默认开启的，使用之前我们需要在使用到的<code>ViewController</code>中手动判断一下：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.traitCollection.forceTouchCapability == <span class="built_in">UIForceTouchCapabilityAvailable</span>) &#123;</span><br><span class="line">        [<span class="keyword">self</span> registerForPreviewingWithDelegate:<span class="keyword">self</span> sourceView:<span class="keyword">self</span>.preBt];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>[self registerForPreviewingWithDelegate:self sourceView:self.preBt];</code>就是将<code>self.preBt</code>这个视图注册允许使用3D Touch功能。然后我们还需要使用到一个协议<code>UIViewControllerPreviewingDelegate</code>，这个协议中有两个方法：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">UIViewController</span> *)previewingContext:(<span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerPreviewing</span>&gt;)previewingContext viewControllerForLocation:(<span class="built_in">CGPoint</span>)location <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">9</span>_0);</span><br><span class="line">- (<span class="keyword">void</span>)previewingContext:(<span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerPreviewing</span>&gt;)previewingContext commitViewController:(<span class="built_in">UIViewController</span> *)viewControllerToCommit <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">9</span>_0);</span><br></pre></td></tr></table></figure>
<p>这两个方法都必须实现，缺一不可，具体的实现过程如下：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">UIViewController</span> *)previewingContext:(<span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerPreviewing</span>&gt;)previewingContext viewControllerForLocation:(<span class="built_in">CGPoint</span>)location</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    previewingContext.sourceRect = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, previewingContext.sourceView.frame.size.width, previewingContext.sourceView.frame.size.height);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UIStoryboard</span> *s = [<span class="built_in">UIStoryboard</span> storyboardWithName:<span class="string">@"Main"</span> bundle:<span class="literal">nil</span>];</span><br><span class="line">    PreViewController *vc = [s instantiateViewControllerWithIdentifier:<span class="string">@"PreViewController"</span>];</span><br><span class="line">    vc.preferredContentSize = <span class="built_in">CGSizeMake</span>(<span class="number">0</span>, <span class="number">300</span>);</span><br><span class="line">    <span class="keyword">return</span> vc;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)previewingContext:(<span class="keyword">id</span> &lt;<span class="built_in">UIViewControllerPreviewing</span>&gt;)previewingContext commitViewController:(<span class="built_in">UIViewController</span> *)viewControllerToCommit </span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.navigationController pushViewController:viewControllerToCommit animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后在我们的目标控制器<code>PreViewController</code>中，可以实现<code>- (NSArray&lt;id&lt;UIPreviewActionItem&gt;&gt; *)previewActionItems</code>，也可以不实现，不实现则没有<code>ActionItem</code>。本文<a href="https://github.com/lovels/LB_3DTouch" target="_blank" rel="noopener"><font color="#6495ED">Demo</font></a></p>
</div></article></div></main><footer><div class="paginator"><a href="/2015/11/25/casharplayer-percent/" class="prev">上一篇</a><a href="/2015/09/28/scrolllabel/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://blog.luobbe.com">luobbe</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>