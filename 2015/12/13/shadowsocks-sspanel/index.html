<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 搭建自己的shadowsocks分享服务器 · luobbe的随笔</title><meta name="description" content="搭建自己的shadowsocks分享服务器 - luobbe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.luobbe.com/atom.xml" title="luobbe的随笔"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://weibo.com/luobbe" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/lovels" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">搭建自己的shadowsocks分享服务器</h1><div class="post-info">2015年12月13日</div><div class="post-content"><blockquote>
<p>本文针对 ss-panel V2 版本的教程，创建于 2015-12-13，更新于 2018-1-4<br>服务器<a href="https://www.vultr.com/?ref=6928081" target="_blank" rel="noopener">vultr</a>、<a href="https://m.do.co/c/fe08bbc0a6c0" target="_blank" rel="noopener">digitalocean</a>，系统版本 <code>Ubuntu 16.04.3 LTS</code> 上测试通过</p>
</blockquote>
<p>周末本想出去转转，无奈帝都的雾霾太大，只能在家里撸码，整了一个ss账号分享平台，在这记录一下过程吧。</p>
<p>本文是基于Ubuntu 14.04下使用后端manyuser和前端ss-panel，使用nginx做代理所搭建的。<br>服务器推荐<a href="https://www.vultr.com/?ref=6928081" target="_blank" rel="noopener">vultr</a>、<a href="https://m.do.co/c/fe08bbc0a6c0" target="_blank" rel="noopener">digitalocean</a>。</p>
<h6 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h6><p>首先我们远程登录服务器，安装nginx,mysql和php,具体命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># apt-get update</span></span><br><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># apt-get install nginx</span></span><br><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># apt-get install mysql-client mysql-server</span></span><br><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># apt-get install php php-fpm php-cli php-cgi php-mysql php-gd</span></span><br></pre></td></tr></table></figure>
<p>过程中如果没有错误，那就说明我们安装成功了，如果服务器中有这些环境，则可以忽略对应的步骤。</p>
<p>接下来我们就要创建数据库了，运行<code>mysql -u root -p</code>，输入<code>root</code>密码。开始创建<code>shadowsocks</code>数据库，具体 SQL:<code>create database shadowsocks;</code> 如下图：</p>
<p><img src="http://ww4.sinaimg.cn/large/9f1201f5gw1eyydknilqkj20vq0c2wkj.jpg" alt=""></p>
<p>然后建立一个名为ss，密码为ss的MySQL用户，因为这个用户只能本地登录，所以密码简单点也无所谓：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  grant all privileges on shadowsocks.* to ss@localhost identified by <span class="string">'ss'</span>;</span><br></pre></td></tr></table></figure>
<p>创建完成我们退出MySQL:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  <span class="built_in">exit</span>；</span><br></pre></td></tr></table></figure>
<p>到这步，我们的数据库已经完成了。<a id="more"></a>下面我们来安装shadowsocks ss-panel supervisor，一次执行下面的命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># apt-get install python-pip git python-m2crypto</span></span><br><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># pip install cymysql</span></span><br><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># git clone -b manyuser https://github.com/mengskysama/shadowsocks.git</span></span><br><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># cd shadowsocks/shadowsocks/</span></span><br></pre></td></tr></table></figure>
<p>如果是服务器上没有git，则需要先安装git，具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># pip install git</span></span><br></pre></td></tr></table></figure>
<p>然后我们来修改配置文件/root/shadowsocks/shadowsocks/Config.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#Config</span><br><span class="line">MYSQL_HOST = &apos;localhost&apos;</span><br><span class="line">MYSQL_PORT = 3306</span><br><span class="line">MYSQL_USER = &apos;ss&apos;</span><br><span class="line">MYSQL_PASS = &apos;ss&apos;</span><br><span class="line">MYSQL_DB = &apos;shadowsocks&apos;</span><br><span class="line">MANAGE_PASS = &apos;ss233333333&apos;</span><br><span class="line">#if you want manage in other server you should set this value to global ip</span><br><span class="line">MANAGE_BIND_IP = &apos;127.0.0.1&apos;</span><br><span class="line">#make sure this port is idle</span><br><span class="line">MANAGE_PORT = 23333</span><br></pre></td></tr></table></figure>
<p>然后我们还要修改这个文件/root/shadowsocks/shadowsocks/config.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"server"</span>:<span class="string">"0.0.0.0"</span>,</span><br><span class="line">    <span class="attr">"server_ipv6"</span>: <span class="string">"[::]"</span>,</span><br><span class="line">    <span class="attr">"server_port"</span>:<span class="number">8388</span>,</span><br><span class="line">    <span class="attr">"local_address"</span>: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">    <span class="attr">"local_port"</span>:<span class="number">1080</span>,</span><br><span class="line">    <span class="attr">"password"</span>:<span class="string">"m"</span>,</span><br><span class="line">    <span class="attr">"timeout"</span>:<span class="number">300</span>,</span><br><span class="line">    <span class="attr">"method"</span>:<span class="string">"aes-256-cfb"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们来导入数据库。进入MySQL：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># mysql -u root -p</span></span><br><span class="line">mysql&gt; use shadowsocks;</span><br><span class="line">mysql&gt; <span class="built_in">source</span> /root/shadowsocks/shadowsocks/shadowsocks.sql;</span><br><span class="line">mysql&gt; <span class="built_in">exit</span>;</span><br></pre></td></tr></table></figure>
<p>导入数据库之后，我们在shadowsocks目录下运行一下server.py，具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># cd shadowsocks/shadowsocks/</span></span><br><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># python server.py</span></span><br></pre></td></tr></table></figure>
<p>没有error的话，ctrl + c结束进程，我们进行下一步,安装守护进程，这样重启以后或者程序崩了还能自己重启。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># apt-get install python-pip python-m2crypto supervisor</span></span><br></pre></td></tr></table></figure>
<p>然后我们需要新建两个文件，具体如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># vim /etc/supervisor/conf.d/shadowsocks.conf</span></span><br></pre></td></tr></table></figure>
<p>具体内容为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[program:shadowsocks]</span><br><span class="line">command=python /root/shadowsocks/shadowsocks/server.py -c /root/shadowsocks/shadowsocks/config.json</span><br><span class="line">autorestart=true</span><br><span class="line">user=root</span><br></pre></td></tr></table></figure>
<p>再创建一个文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># vim /etc/supervisor/conf.d/cgi.conf</span></span><br></pre></td></tr></table></figure>
<p>具体内容为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[program:cgi]</span><br><span class="line">command=php-cgi -b localhost:9000</span><br><span class="line">autorestart=true</span><br><span class="line">user=root</span><br></pre></td></tr></table></figure>
<p>然后命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># cd shadowsocks/shadowsocks</span></span><br><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># service supervisor start</span></span><br><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># supervisorctl reload</span></span><br></pre></td></tr></table></figure>
<p>在以下两个文件<code>/etc/profile</code>和<br><code>/etc/default/supervisor</code>结尾添加如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ulimit -n 51200</span><br><span class="line">ulimit -Sn 4096</span><br><span class="line">ulimit -Hn 8192</span><br></pre></td></tr></table></figure>
<p>至此ss的后端服务已经搞定了，现在我们来整前端界面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-512mb-sfo1-01:~# cd /usr/share/nginx/</span><br><span class="line">root@ubuntu-512mb-sfo1-01:~# git clone -b v2 https://github.com/orvice/ss-panel.git</span><br></pre></td></tr></table></figure>
<p>重命名文件夹,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-512mb-sfo1-01:~# mv ss-panel ss</span><br></pre></td></tr></table></figure>
<p>现在来修改文件夹权限,</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># cd /usr/share/nginx/</span></span><br><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># chmod 777 * -R /usr/share/nginx/html</span></span><br><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># chmod 777 * -R /usr/share/nginx/ss</span></span><br><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># chown -R www-data:www-data /usr/share/nginx/html</span></span><br><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># chown -R www-data:www-data /usr/share/nginx/ss</span></span><br></pre></td></tr></table></figure>
<p>然后我们需要将ss-panel中的数据库导入我们刚刚创建的数据库中，还是进入MySQL：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-512mb-sfo1-01:~# mysql -u root -p</span><br><span class="line">mysql&gt; use shadowsocks;</span><br><span class="line">mysql&gt; source /usr/share/nginx/ss/sql/invite_code.sql;</span><br><span class="line">mysql&gt; source /usr/share/nginx/ss/sql/ss_user_admin.sql;</span><br><span class="line">mysql&gt; source /usr/share/nginx/ss/sql/ss_node.sql;</span><br><span class="line">mysql&gt; source /usr/share/nginx/ss/sql/ss_reset_pwd.sql;</span><br><span class="line">mysql&gt; source /usr/share/nginx/ss/sql/user.sql;</span><br><span class="line">mysql&gt; exit;</span><br></pre></td></tr></table></figure>
<p>然后我们来修改配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># cd /usr/share/nginx</span></span><br><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment">#  mv /usr/share/nginx/ss/lib/config-simple.php /usr/share/nginx/ss/lib/config.php</span></span><br></pre></td></tr></table></figure>
<p>以下是congfig.php文件的内容我们可以针对自己的需求来修改，重点先修改 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//Define DB Connection  数据库信息</span><br><span class="line">define(&apos;DB_HOST&apos;,&apos;localhost&apos;);   </span><br><span class="line">define(&apos;DB_USER&apos;,&apos;ss&apos;); # 我们最开始创建的 ss 用户</span><br><span class="line">define(&apos;DB_PWD&apos;,&apos;ss&apos;);  # ss 用户的数据库密码</span><br><span class="line">define(&apos;DB_DBNAME&apos;,&apos;shadowsocks&apos;); # 数据库名字</span><br><span class="line">define(&apos;DB_CHARSET&apos;,&apos;utf8&apos;);</span><br><span class="line">define(&apos;DB_TYPE&apos;,&apos;mysql&apos;);</span><br></pre></td></tr></table></figure>
<p>完整的配置文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * ss-panel配置文件</span></span><br><span class="line"><span class="comment"> * https://github.com/orvice/ss-panel</span></span><br><span class="line"><span class="comment"> * Author <span class="doctag">@orvice</span></span></span><br><span class="line"><span class="comment"> * https://orvice.org</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义流量</span></span><br><span class="line">$tokb = <span class="number">1024</span>;</span><br><span class="line">$tomb = <span class="number">1024</span>*<span class="number">1024</span>;</span><br><span class="line">$togb = $tomb*<span class="number">1024</span>;</span><br><span class="line"><span class="comment">//Define DB Connection  数据库信息</span></span><br><span class="line">define(<span class="string">'DB_HOST'</span>,<span class="string">'localhost'</span>);</span><br><span class="line">define(<span class="string">'DB_USER'</span>,<span class="string">'ss'</span>); <span class="comment">#</span></span><br><span class="line">define(<span class="string">'DB_PWD'</span>,<span class="string">'ss'</span>);</span><br><span class="line">define(<span class="string">'DB_DBNAME'</span>,<span class="string">'shadowsocks'</span>);</span><br><span class="line">define(<span class="string">'DB_CHARSET'</span>,<span class="string">'utf8'</span>);</span><br><span class="line">define(<span class="string">'DB_TYPE'</span>,<span class="string">'mysql'</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 下面的东西根据需求修改</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//define Plan</span></span><br><span class="line"><span class="comment">//注册用户的初始化流量</span></span><br><span class="line"><span class="comment">//默认5GiB</span></span><br><span class="line">$a_transfer = $togb*<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//签到设置 签到活的的最低最高流量,单位MB</span></span><br><span class="line">$check_min = <span class="number">1</span>;</span><br><span class="line">$check_max = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//name</span></span><br><span class="line">$site_name = <span class="string">"ss-panel"</span>;</span><br><span class="line">$site_url  = <span class="string">"https://panel.com/"</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 站点盐值，用于加密密码</span></span><br><span class="line"><span class="comment"> * 第一次安装请修改此值，安装后请勿修改！！否则会使所有密码失效，仅限加密方式不为1的时候有效</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">$salt = <span class="string">"ss-panel"</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 密码加密方式，注意： 2.4以前的版本，请修改加密方式为「1」，否则会使密码失效！</span></span><br><span class="line"><span class="comment"> * 更多说明见wiki https://github.com/orvice/ss-panel/wiki/Install-Guide-zh_cn</span></span><br><span class="line"><span class="comment"> * 加密方式:</span></span><br><span class="line"><span class="comment"> * 1 md5</span></span><br><span class="line"><span class="comment"> * 2 带salt的Sha256加密，新安装建议使用此加密方式！</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">$pwd_mode = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//用户注册后获得的邀请码最低最高</span></span><br><span class="line"><span class="comment">//都设置为0用户就不能邀请</span></span><br><span class="line">$user_invite_min = <span class="string">'1'</span>;</span><br><span class="line">$user_invite_max = <span class="string">'1'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//选择邮件服务</span></span><br><span class="line"><span class="comment">// smtp未完成，现在只能用mailgun</span></span><br><span class="line"><span class="comment">//mail-gun</span></span><br><span class="line"><span class="comment">//mail-smtp</span></span><br><span class="line">$Selectmailservice = <span class="string">"mail-gun"</span>;</span><br><span class="line"><span class="comment">//邮件发件人</span></span><br><span class="line">$sender = <span class="string">"xxx@xxx.xx"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//mail-gun</span></span><br><span class="line"><span class="comment">// Get your key from https://mailgun.com</span></span><br><span class="line">$mailgun_key = <span class="string">""</span>;</span><br><span class="line">$mailgun_domain = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//mail-smtp</span></span><br><span class="line"><span class="comment">// smtp发件方式暂时无法使用</span></span><br><span class="line"><span class="comment">//设置smtp服务器连接方式:  </span></span><br><span class="line"><span class="comment">//加密连接(ssl) = "1"</span></span><br><span class="line"><span class="comment">//普通连接 = "0"</span></span><br><span class="line">$mail_smtp_Connection = <span class="string">"1"</span>;</span><br><span class="line"><span class="comment">//smtp服务器端口 25 , 465 ...</span></span><br><span class="line">$mail_smtp_Port = <span class="number">465</span>;</span><br><span class="line"><span class="comment">//smtp服务器</span></span><br><span class="line">$mail_smtp_Server = <span class="string">"smtp.gmail.com"</span>;</span><br><span class="line"><span class="comment">//邮件帐号</span></span><br><span class="line">$mail_smtp_Account = <span class="string">"xxxx@gmail.com"</span>;</span><br><span class="line"><span class="comment">//邮件密码</span></span><br><span class="line">$mail_smtp_password = <span class="string">"密码"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">'do.php'</span>;</span><br></pre></td></tr></table></figure>
<p>到此，ss-panel前端界面也安装完毕，然后我们需要修改一下Nginx配置文件，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># cd /etc/nginx/sites-available/</span></span><br><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># vim default</span></span><br></pre></td></tr></table></figure>
<p>把default文件修改成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	listen 443;</span><br><span class="line">	server_name localhost;</span><br><span class="line">	server_name_in_redirect off;</span><br><span class="line">	root /usr/share/nginx/ss;</span><br><span class="line">	index index.php index.html index.htm;</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">		try_files $uri $uri/ /index.php?q=$uri&amp;$args;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	location ~ \.php$ &#123;</span><br><span class="line">		include /etc/nginx/fastcgi_params;</span><br><span class="line">		fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">		fastcgi_index index.php;</span><br><span class="line">		fastcgi_param SCRIPT_FILENAME /usr/share/nginx/ss$fastcgi_script_name;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后重启一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-512mb-sfo1-01:~<span class="comment"># shutdown -r now</span></span><br></pre></td></tr></table></figure>
<p>然后我们访问<code>http://ip:443</code>就可以看到ss-panel前端界面了：</p>
<p><img src="http://ww1.sinaimg.cn/large/9f1201f5gw1eyydl4hdbuj21kw15edog.jpg" alt=""></p>
<p>后端我们可以<code>http://ip:443/admin</code>界面如下<br><img src="http://ww1.sinaimg.cn/large/9f1201f5gw1eyydlkveq7j20rs0jygmc.jpg" alt=""><br>如果不知道账户名，密码的话，我们可以去数据库查一下，我们可以登录数据库中，看一下<code>shadowsocks</code>库中的表</p>
<p><img src="http://ww1.sinaimg.cn/large/9f1201f5gw1eyydlxnkt2j20jq0akmz7.jpg" alt=""></p>
<p>我们可以查一下<code>ss_user_admin</code>表和<code>user</code>看一下管理员和用户，然后登录后台，进行相应地操作。如果要设置新的管理员，我们可以再导入 user.sql 之前修改里面的信息</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fn4fi7newtj310x0hxq7n.jpg" alt="user.sql"></p>
<p>或者我们直接写 SQL 语句来修改，<code>mysql -u root -p</code>，进入 mysql，切换 DataBase为 <code>shadowsocks</code>，执行下面的 SQL 预计即可</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> user_name = <span class="string">'user_name'</span>, email = <span class="string">'邮箱'</span>, pass = <span class="string">'md5-32位小写'</span>;</span><br></pre></td></tr></table></figure>
<p>然后通过<code>http://ip:443/admin</code>登录</p>
<p>到此，ss前后台管理多用户的分享平台就这样建成了。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2015/12/29/写在2015年末/" class="prev">上一篇</a><a href="/2015/11/25/casharplayer-percent/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://blog.luobbe.com">luobbe</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-72079763-1",'auto');ga('send','pageview');</script></body></html>